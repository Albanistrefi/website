---
import { Link } from './Link';
import { CalendarIcon, ClockIcon } from './Icons';
import { H3, Body, Metadata } from './Typography';
import { formatDate, getReadingTimeText } from '@/utils';
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'writing'>;
}

const { post } = Astro.props;
const { title, description, publishDate, tags } = post.data;
const readingTime = getReadingTimeText(post.body);
const transitionName = title?.toLowerCase().replace(/\W+/g, '-') || post.slug;
---

<article class="group pb-6 mb-6 transition-colors duration-200">
  <H3 client:load className="mb-2">
    <Link client:load href={`/writing/${post.slug}`} variant="default">
      <span transition:name={transitionName}>{title}</span>
    </Link>
  </H3>

  <div class="flex flex-wrap gap-4 mb-3">
    <div class="flex items-center gap-1.5">
      <CalendarIcon client:load />
      <Metadata client:load>{formatDate(publishDate)}</Metadata>
    </div>
    <div class="flex items-center gap-1.5">
      <ClockIcon client:load />
      <Metadata client:load>{readingTime}</Metadata>
    </div>
  </div>

  <Body client:load className="mb-4">
    {description}
  </Body>

  {tags && tags.length > 0 && (
    <div class="flex flex-wrap gap-2">
      {tags.map((tag: string) => (
        <span class="text-xs text-muted bg-background-secondary px-2 py-1 rounded tag-chip">
          {tag}
        </span>
      ))}
    </div>
  )}
</article>
